
{
  "fileTypes": ["baml"],
  "name": "baml",
  "patterns": [
    {
      "include": "#comment"
    },
    {
      "include": "#schema"
    }
  ],
  "repository": {
    "schema": {
      "patterns": [
        {
          "include": "#enum_declaration"
        },
        {
          "include": "#interface_declaration"
        },
        {
          "include": "#template_string_declaration"
        },
        {
          "include": "#function_declaration"
        },
        {
          "include": "#function_application"
        },
        {
          "include": "#let_declaration"
        },
        {
          "include": "#config_block"
        },
        {
          "include": "#type_alias"
        },
        {
          "include": "#function"
        },
        {
          "include": "#language_block_python"
        },
        {
          "include": "#language_block_ts"
        },
        {
          "include": "#language_block_jinja"
        },
        {
          "include": "#type_builder"
        }
      ]
    },
    "comment": {
      "patterns": [
        {
          "name": "comment.line",
          "match": "//.*"
        },
        {
          "name": "comment.block.documentation",
          "begin": "///",
          "end": "$",
          "patterns": [
            {
              "name": "comment.block.documentation",
              "match": ".*"
            }
          ]
        },
        {
          "include": "#curly_comment"
        }
      ]
    },
    "enum_declaration": {
      "begin": "(enum)\\s+(\\w+)",
      "beginCaptures": {
        "1": {
          "name": "storage.type.enum"
        },
        "2": {
          "name": "entity.name.type"
        }
      },
      "end": "\\}",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#block_attribute"
        },
        {
          "name": "variable.other.field",
          "match": "\\b[A-Za-z_][A-Za-z0-9_]*\\b"
        }
      ]
    },
    "interface_declaration": {
      "begin": "(class|override)\\s+(\\w+)\\s*\\{",
      "beginCaptures": {
        "1": {
          "name": "storage.type.declaration.interface"
        },
        "2": {
          "name": "entity.name.type"
        }
      },
      "end": "\\}",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "comment": "Property + Type",
          "begin": "(\\w+)",
          "beginCaptures": {
            "1": {
              "name": "variable.other.readwrite"
            }
          },
          "end": "(?=$|\\n|@|\\}|/)",
          "patterns": [
            {
              "include": "#type_definition"
            }
          ]
        },
        {
          "include": "#block_attribute"
        }
      ]
    },
    "dynamic_declaration": {
      "begin": "(dynamic)\\s+(\\w+)\\s*\\{",
      "beginCaptures": {
        "1": {
          "name": "storage.type.dynamic"
        },
        "2": {
          "name": "entity.name.type.dynamic"
        }
      },
      "end": "\\}",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "comment": "Property + Type",
          "begin": "(\\w+)",
          "beginCaptures": {
            "1": {
              "name": "variable.other.readwrite"
            }
          },
          "end": "(?=$|\\n|@|\\}|/)",
          "patterns": [
            {
              "include": "#type_definition"
            }
          ]
        },
        {
          "name": "variable.other.field",
          "match": "\\b[A-Za-z_][A-Za-z0-9_]*\\b"
        },
        {
          "include": "#block_attribute"
        }
      ]
    },
    "template_string_declaration": {
      "begin": "(template_string)\\s+(\\w+)",
      "beginCaptures": {
        "1": {
          "name": "storage.type.declaration.function"
        },
        "2": {
          "name": "entity.name.function"
        }
      },
      "end": "^(\"#{1,3})",
      "endCaptures": {
        "1": {
          "name": "string.quoted.block.baml.end"
        }
      },
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#function_parameters"
        },
        {
          "include": "#template_string_body"
        }
      ]
    },
    "template_string_body": {
      "begin": "\\s+(#{1,3})(\")",
      "beginCaptures": {
        "1": {
          "name": "string.quoted.block.baml.body.start"
        },
        "2": {
          "name": "string.quoted.block.baml.body.start"
        }
      },
      "end": "(?=\"\\1)",
      "contentName": "string.quoted.block.baml.body",
      "patterns": [
        {
          "include": "source.baml-jinja"
        }
      ]
    },
    "function_declaration": {
      "comment": "Function declaration",
      "begin": "(function)\\s+(\\w+)",
      "beginCaptures": {
        "1": {
          "name": "storage.type.declaration.function"
        },
        "2": {
          "name": "entity.name.function"
        }
      },
      "end": "\\}",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#function_parameters"
        },
        {
          "include": "#arrow_return_type"
        },
        {
          "include": "#function_body"
        }
      ]
    },
    "function_application": {
      "begin": "(\\w+)\\s*\\(",
      "beginCaptures": {
        "1": {
          "name": "entity.name.function"
        }
      },
      "end": "\\)",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#string_literal"
        },
        {
          "include": "#constant_numeric"
        },
        {
          "match": "(\\w+)\\s*(?:,|$|\\))",
          "captures": {
            "1": {
              "name": "variable.parameter"
            }
          }
        },
        {
          "include": "#function_application"
        }
      ]
    },
    "let_declaration": {
      "comment": "Let declaration",
      "begin": "(let)\\s+(\\w+)\\s*(=)",
      "beginCaptures": {
        "1": {
          "name": "storage.type.declaration.let"
        },
        "2": {
          "name": "variable.other.readwrite"
        },
        "3": {
          "name": "keyword.operator.assignment"
        }
      },
      "end": ";",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#string_literal"
        },
        {
          "include": "#constant_numeric"
        },
        {
          "include": "#function_parameters"
        },
        {
          "include": "#arrow_return_type"
        },
        {
          "include": "#function_application"
        },
        {
          "include": "#object_construction"
        },
        {
          "include": "#function_body"
        }
      ]
    },
    "function_parameters": {
      "begin": "\\(",
      "end": "\\)",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#function_name_type"
        }
      ],
      "contentName": "function.params"
    },
    "function_name_type": {
      "patterns": [
        {
          "match": "(\\w+)\\s*:",
          "captures": {
            "1": {
              "name": "variable.other.readwrite"
            }
          }
        },
        {
          "include": "#type_definition"
        }
      ]
    },
    "type_definition": {
      "patterns": [
        {
          "match": "\\b(bool|int|float|string|null|image|audio|pdf)\\b",
          "name": "storage.type.baml"
        },
        {
          "begin": "(map)\\s*<",
          "beginCaptures": {
            "1": {
              "name": "storage.type.baml"
            }
          },
          "patterns": [
            {
              "include": "#type_definition"
            },
            {
              "include": "#type_definition"
            }
          ],
          "end": ">"
        },
        {
          "match": "\\b(true|false)\\b",
          "name": "constant.language.boolean"
        },
        {
          "match": "\\w+",
          "name": "support.type"
        },
        {
          "include": "#string_literal"
        },
        {
          "match": "\\[\\]",
          "name": "keyword.control.baml"
        },
        {
          "match": "\\?",
          "name": "keyword.control.baml"
        },
        {
          "comment": "union a | b | c",
          "match": "\\|",
          "name": "keyword.control.baml"
        },
        {
          "comment": "Groups",
          "begin": "\\(",
          "beginCaptures": {
            "0": {
              "name": "keyword.control"
            }
          },
          "end": "(\\))(\\[\\])*(\\?)?",
          "endCaptures": {
            "1": {
              "name": "keyword.control"
            },
            "2": {
              "name": "keyword.control"
            },
            "3": {
              "name": "keyword.control"
            }
          },
          "patterns": [
            {
              "include": "#type_definition"
            }
          ]
        }
      ]
    },
    "arrow_return_type": {
      "begin": "(?<=\\))\\s*(->)\\s*",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.baml.arrow"
        }
      },
      "end": "(?=\\{)",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#type_definition"
        }
      ]
    },
    "function_body": {
      "begin": "(?<=\\{)\\s*",
      "end": "(?=\\})",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#markdown_header"
        },
        {
          "include": "#block_attribute"
        },
        {
          "include": "#let_declaration"
        },
        {
          "include": "#for_in_loop"
        },
        {
          "include": "#for_c_loop"
        },
        {
          "include": "#if_statement"
        },
        {
          "include": "#else_clause"
        },
        {
          "include": "#while_statement"
        },
        {
          "include": "#assignment_statement"
        },
        {
          "include": "#object_construction"
        },
        {
          "comment": "Function client properties",
          "patterns": [
            {
              "match": "(client)\\s+(\\w+|\"[^\"]*\")",
              "captures": {
                "1": {
                  "name": "variable.other.readwrite.client"
                },
                "2": {
                  "patterns": [
                    {
                      "match": "\\w+",
                      "name": "entity.name.other.client"
                    },
                    {
                      "include": "#string_literal"
                    }
                  ]
                }
              },
              "name": "meta.client.declaration"
            },
            {
              "begin": "\\s+(prompt)\\s+(#{1,5})(\")",
              "beginCaptures": {
                "1": {
                  "name": "variable.other.readwrite.prompt"
                },
                "2": {
                  "name": "string.quoted.block.baml.prompt"
                },
                "3": {
                  "name": "string.quoted.block.baml.prompt"
                }
              },
              "end": "\\s*(\"\\2)",
              "contentName": "string.quoted.block.baml.prompt",
              "endCaptures": {
                "0": {
                  "name": "string.quoted.block.baml.prompt"
                }
              },
              "patterns": [
                {
                  "include": "source.baml-jinja"
                }
              ]
            }
          ]
        }
      ]
    },
    "key_value_pair": {
      "begin": "(\\w+)\\s*",
      "beginCaptures": {
        "1": {
          "name": "variable.other.readwrite.key_value_pair"
        }
      },
      "end": "(?=\\n)",
      "patterns": [
        {
          "include": "#string_literal"
        }
      ]
    },
    "keyword": {
      "patterns": [
        {
          "match": "\\b(input|output)\\b",
          "name": "keyword.special.input-output"
        }
      ]
    },
    "single_variable_no_assignment": {
      "match": "^\\s*\\w+\\b",
      "name": "variable.other.readwrite.single_var"
    },
    "config_block": {
      "begin": "(client|generator|retry_policy|printer|test)\\s*(<([^>]+)>)?\\s+(\\w+)\\s*\\{",
      "beginCaptures": {
        "1": {
          "name": "storage.type.declaration"
        },
        "3": {
          "name": "storage.type.declaration"
        },
        "4": {
          "name": "entity.name.type"
        }
      },
      "end": "\\}",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#block_attribute"
        },
        {
          "include": "#type_builder"
        },
        {
          "include": "#property_assignment_expression"
        }
      ]
    },
    "block_attribute": {
      "patterns": [
        {
          "begin": "(@{1,2}(?:check|assert))\\s*\\(\\s*(?=\\{\\{)",
          "beginCaptures": {
            "1": {
              "name": "entity.name.function.attribute"
            }
          },
          "end": "\\)\\s*",
          "contentName": "string.quoted.block.thing",
          "patterns": [
            {
              "include": "source.baml-jinja"
            }
          ]
        },
        {
          "begin": "(@{1,2}(?:check|assert))\\s*\\(([^,]+)?\\s*,\\s*(?=\\{\\{)",
          "beginCaptures": {
            "1": {
              "name": "entity.name.function.attribute"
            },
            "2": {
              "name": "variable.parameter.checkName"
            }
          },
          "end": "\\)\\s*",
          "contentName": "string.quoted.block.thing",
          "patterns": [
            {
              "include": "source.baml-jinja"
            }
          ]
        },
        {
          "begin": "(@{1,2}(?:check|assert))\\(([^,]+)?\\s*,\\s*()",
          "beginCaptures": {
            "1": {
              "name": "entity.name.function.attribute"
            },
            "2": {
              "name": "variable.parameter.checkName"
            }
          },
          "end": "\\)",
          "contentName": "string.quoted.block.thing",
          "patterns": [
            {
              "include": "source.baml-jinja"
            }
          ]
        },
        {
          "begin": "(@{1,2}\\w+)\\(#\"",
          "beginCaptures": {
            "1": {
              "name": "entity.name.function.attribute"
            }
          },
          "end": "\"#\\)",
          "name": "string.quoted.block.baml",
          "patterns": [
            {
              "include": "#comment"
            },
            {
              "include": "#language_block_python"
            },
            {
              "include": "#language_block_ts"
            },
            {
              "include": "#key_value"
            },
            {
              "include": "#block_string_pair"
            },
            {
              "include": "#string_literal"
            },
            {
              "match": "\\(",
              "name": "punctuation.section.parens.open"
            },
            {
              "match": "\\)",
              "name": "punctuation.section.parens.close"
            }
          ]
        },
        {
          "begin": "(@{1,2}\\w+)\\(#{1,3}\"",
          "beginCaptures": {
            "1": {
              "name": "entity.name.function.attribute"
            }
          },
          "end": "\"#{1,3}\\)",
          "name": "string.quoted.block.baml",
          "patterns": [
            {
              "include": "#comment"
            },
            {
              "include": "#language_block_python"
            },
            {
              "include": "#language_block_ts"
            },
            {
              "include": "#key_value"
            },
            {
              "include": "#block_string_pair"
            },
            {
              "include": "#string_literal"
            },
            {
              "match": "\\(",
              "name": "punctuation.section.parens.open"
            },
            {
              "match": "\\)",
              "name": "punctuation.section.parens.close"
            }
          ]
        },
        {
          "begin": "(@{1,2}\\w+)\\(",
          "beginCaptures": {
            "1": {
              "name": "entity.name.function.attribute"
            }
          },
          "end": "\\)",
          "patterns": [
            {
              "include": "#string_unquoted"
            },
            {
              "include": "#comment"
            },
            {
              "include": "#language_block_python"
            },
            {
              "include": "#language_block_ts"
            },
            {
              "include": "#key_value"
            },
            {
              "include": "#block_string_pair"
            },
            {
              "include": "#string_literal",
              "name": "string.quoted.double"
            },
            {
              "match": "\\(",
              "name": "punctuation.section.parens.open"
            },
            {
              "match": "\\)",
              "name": "punctuation.section.parens.close"
            }
          ]
        },
        {
          "begin": "(@{1,2}\\w+)\\(\"",
          "beginCaptures": {
            "1": {
              "name": "entity.name.function.attribute"
            }
          },
          "end": "\"\\)",
          "patterns": [
            {
              "include": "#string_literal",
              "name": "string.quoted.double"
            }
          ]
        },
        {
          "begin": "(@{1,2}\\w+)\\(",
          "beginCaptures": {
            "1": {
              "name": "entity.name.function.attribute"
            }
          },
          "end": "\\)",
          "patterns": [
            {
              "match": "\\w+",
              "name": "string.unquoted"
            }
          ]
        },
        {
          "begin": "(@{1,2}\\w+)\\(#{1,3}",
          "beginCaptures": {
            "1": {
              "name": "entity.name.function.attribute"
            }
          },
          "end": "#{1,3}\\)",
          "name": "string.quoted.block.baml",
          "patterns": [
            {
              "name": "constant.character.escape",
              "match": "\\\\."
            },
            {
              "name": "meta.embedded.block_attribute",
              "begin": "\\(",
              "end": "\\)"
            },
            {
              "include": "#comment"
            },
            {
              "include": "#language_block_python"
            },
            {
              "include": "#language_block_ts"
            },
            {
              "include": "#key_value"
            },
            {
              "include": "#block_string_pair"
            },
            {
              "include": "#string_literal"
            },
            {
              "match": ".",
              "name": "text.plain"
            }
          ]
        }
      ]
    },
    "key_value": {
      "begin": "\\s*\\{",
      "end": "\\s*\\}",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#property_assignment_expression"
        }
      ]
    },
    "property_assignment_expression": {
      "patterns": [
        {
          "include": "#key_null_pair"
        },
        {
          "include": "#language_block_python"
        },
        {
          "include": "#language_block_ts"
        },
        {
          "include": "#block_string_pair"
        },
        {
          "include": "#key_value"
        },
        {
          "include": "#comment"
        },
        {
          "include": "#key_string_pair"
        },
        {
          "include": "#key_quoted_string_pair"
        },
        {
          "include": "#key_number_pair"
        },
        {
          "include": "#key_boolean_pair"
        },
        {
          "include": "#key_array_pair"
        },
        {
          "include": "#key_custom_string_pair"
        },
        {
          "include": "#nested_key_value"
        }
      ]
    },
    "nested_key_value": {
      "begin": "(\"\\w+\"|\\b\\w+\\b)\\s+\\{",
      "end": "\\}",
      "captures": {
        "1": {
          "name": "variable.other.readwrite.nested_key"
        }
      },
      "contentName": "variable.other.readwrite.nested",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#key_value"
        },
        {
          "include": "#key_null_pair"
        },
        {
          "include": "#key_string_pair"
        },
        {
          "include": "#language_block_python"
        },
        {
          "include": "#language_block_ts"
        },
        {
          "include": "#block_string_pair"
        },
        {
          "include": "#key_quoted_string_pair"
        },
        {
          "include": "#key_number_pair"
        },
        {
          "include": "#key_boolean_pair"
        },
        {
          "include": "#key_array_pair"
        },
        {
          "include": "#key_custom_string_pair"
        }
      ]
    },
    "language_block_jinja": {
      "begin": "(jinja)(#{1,3}\")",
      "beginCaptures": {
        "1": {
          "name": "comment.line"
        },
        "2": {
          "name": "string.quoted"
        }
      },
      "end": "\\s*(\"{1,3}#)",
      "endCaptures": {
        "1": {
          "name": "string.quoted"
        }
      },
      "contentName": "source.baml-jinja.embedded",
      "patterns": [
        {
          "include": "source.baml-jinja"
        }
      ]
    },
    "language_block_python": {
      "begin": "(python)(#{1,3}\")",
      "beginCaptures": {
        "1": {
          "name": "comment.line"
        },
        "2": {
          "name": "string.quoted"
        }
      },
      "end": "\\s*(\"{1,3}#)",
      "endCaptures": {
        "1": {
          "name": "string.quoted"
        }
      },
      "contentName": "source.python.embedded",
      "patterns": [
        {
          "include": "source.python"
        }
      ]
    },
    "language_block_ts": {
      "begin": "(typescript)(#{1,3}\")",
      "beginCaptures": {
        "1": {
          "name": "comment.line"
        },
        "2": {
          "name": "string.quoted"
        }
      },
      "end": "\\s*(\"{1,3}#)",
      "endCaptures": {
        "1": {
          "name": "string.quoted"
        }
      },
      "contentName": "source.ts.embedded",
      "patterns": [
        {
          "include": "source.ts"
        }
      ]
    },
    "block_string_pair": {
      "begin": "(\\w+)?\\s+(#{1,3}(\"){1,3})",
      "beginCaptures": {
        "1": {
          "name": "variable.other.readwrite.block_string_pair"
        },
        "2": {
          "name": "string.quoted.block.baml.startquote"
        }
      },
      "end": "((\"){1,3}#{1,3})",
      "endCaptures": {
        "1": {
          "name": "string.quoted.block.baml.endquote"
        }
      },
      "contentName": "string.quoted.block.baml.stringpair",
      "patterns": [
        {
          "include": "#curly_comment"
        },
        {
          "name": "entity.name.type.chat",
          "match": "\\{#chat\\([^}]*\\)}"
        },
        {
          "name": "keyword.special.string.code",
          "match": "\\{#[a-zA-Z_][a-zA-Z0-9_.()><]*}"
        }
      ]
    },
    "curly_comment": {
      "begin": "\\{//",
      "beginCaptures": {},
      "end": "//}",
      "endCaptures": {},
      "name": "comment.line.double-slash.baml",
      "patterns": [
        {
          "include": "#language_block_python"
        },
        {
          "include": "#language_block_ts"
        }
      ]
    },
    "key_quoted_string_pair": {
      "match": "(\"[^\"]+\")\\s+(\"[^\"]+\")",
      "captures": {
        "1": {
          "name": "string.quoted.double"
        },
        "2": {
          "name": "string.quoted.double"
        }
      }
    },
    "key_string_pair": {
      "begin": "(\"\\w+\"|\\b\\w+\\b)\\s+(\")",
      "beginCaptures": {
        "1": {
          "name": "variable.other.readwrite.key_string_pair"
        },
        "2": {
          "name": "string.quoted.double"
        }
      },
      "end": "\"",
      "endCaptures": {
        "0": {
          "name": "string.quoted.double"
        }
      },
      "patterns": [
        {
          "name": "constant.character.escape",
          "match": "\\\\."
        },
        {
          "name": "string.quoted.double",
          "match": "[^\"\\\\]+"
        }
      ]
    },
    "key_custom_string_pair": {
      "match": "(\"\\w+\"|\\b\\w+\\b)\\s+((?!null)[^\\s\\[\\{]+)",
      "captures": {
        "1": {
          "name": "variable.other.readwrite.custom_string"
        },
        "2": {
          "name": "string.unquoted"
        }
      }
    },
    "key_number_pair": {
      "match": "(\"\\w+\"|\\b\\w+\\b)\\s+(\\b\\d+\\b)",
      "captures": {
        "1": {
          "name": "variable.other.readwrite.number_pair"
        },
        "2": {
          "name": "constant.numeric"
        }
      }
    },
    "key_boolean_pair": {
      "match": "(\"\\w+\"|\\b\\w+\\b)\\s+(\\btrue\\b|\\bfalse\\b)",
      "captures": {
        "1": {
          "name": "variable.other.readwrite"
        },
        "2": {
          "name": "constant.language.boolean"
        }
      }
    },
    "key_null_pair": {
      "match": "(\"\\w+\"|\\b\\w+\\b)\\s+(\\bnull\\b)",
      "captures": {
        "1": {
          "name": "variable.other.readwrite.null"
        },
        "2": {
          "name": "constant.language.nil.null"
        }
      }
    },
    "key_array_pair": {
      "begin": "(\"\\w+\"|\\b\\w+\\b)\\s+\\[",
      "end": "\\]",
      "captures": {
        "1": {
          "name": "variable.other.readwrite"
        }
      },
      "contentName": "variable.other.readwrite.array",
      "patterns": [
        {
          "include": "#key_array_pair"
        },
        {
          "include": "#string_quoted2"
        },
        {
          "include": "#constant_numeric"
        }
      ]
    },
    "string_quoted2": {
      "name": "string.quoted.double",
      "begin": "\"",
      "end": "\"",
      "patterns": [
        {
          "name": "constant.character.escape",
          "match": "\\\\."
        }
      ]
    },
    "string_unquoted": {
      "match": "\\b[\\w-]+\\b",
      "name": "string.unquoted"
    },
    "constant_numeric": {
      "match": "\\b\\d+\\b",
      "name": "constant.numeric"
    },
    "type_alias": {
      "begin": "(type)\\s+(\\w+)\\s*(=)",
      "beginCaptures": {
        "1": {
          "name": "storage.type.declaration"
        },
        "2": {
          "name": "entity.name.type"
        },
        "3": {
          "name": "keyword.operator.assignment"
        }
      },
      "end": "(?=$|\\n)",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "begin": "(?<=\\=)\\s*",
          "end": "(?=//|$|\\n)",
          "patterns": [
            {
              "include": "#type_definition"
            },
            {
              "include": "#block_attribute"
            }
          ]
        }
      ]
    },
    "invalid_assignment": {
      "name": "invalid.illegal",
      "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\s+[a-zA-Z_][a-zA-Z0-9_]*\\s+[a-zA-Z_][a-zA-Z0-9_]*"
    },
    "string_literal": {
      "match": "\"[^\"]*\"",
      "name": "string.quoted.double"
    },
    "type_builder": {
      "begin": "(type_builder)\\s*\\{",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.type_builder"
        }
      },
      "end": "\\}",
      "patterns": [
        {
          "include": "#interface_declaration"
        },
        {
          "include": "#enum_declaration"
        },
        {
          "include": "#dynamic_declaration"
        },
        {
          "include": "#type_alias"
        },
        {
          "include": "#comment"
        }
      ]
    },
    "for_in_loop": {
      "comment": "For-in loop",
      "begin": "(for)\\s*\\(\\s*(\\w+)\\s+(in)\\s+",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.for"
        },
        "2": {
          "name": "variable.other.readwrite"
        },
        "3": {
          "name": "keyword.control.in"
        }
      },
      "end": "\\}",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#array_literal"
        },
        {
          "include": "#function_application"
        },
        {
          "include": "#expression_body"
        }
      ]
    },
    "for_c_loop": {
      "comment": "C-style for loop",
      "begin": "(for)\\s*\\(\\s*",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.for"
        }
      },
      "end": "\\}",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#for_c_init_statement"
        },
        {
          "include": "#for_c_condition"
        },
        {
          "include": "#for_c_update"
        },
        {
          "include": "#let_declaration"
        },
        {
          "include": "#assignment_statement"
        },
        {
          "include": "#binary_operators"
        },
        {
          "include": "#increment_operators"
        },
        {
          "include": "#expression_body"
        }
      ]
    },
    "if_statement": {
      "comment": "If-else statement",
      "begin": "(if)\\s*\\(",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.if"
        }
      },
      "end": "(?<=\\})",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#binary_operators"
        },
        {
          "include": "#expression"
        },
        {
          "include": "#expression_body"
        },
        {
          "include": "#else_clause"
        }
      ]
    },
    "else_clause": {
      "comment": "Else clause",
      "match": "(else)\\s*(if)?",
      "captures": {
        "1": {
          "name": "keyword.control.else"
        },
        "2": {
          "name": "keyword.control.if"
        }
      }
    },
    "while_statement": {
      "comment": "While loop",
      "begin": "(while)\\s*\\(",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.while"
        }
      },
      "end": "\\}",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#binary_operators"
        },
        {
          "include": "#expression"
        },
        {
          "include": "#expression_body"
        }
      ]
    },
    "assignment_statement": {
      "comment": "Assignment with operators",
      "begin": "(\\w+)\\s*([+\\-*/]?=)",
      "beginCaptures": {
        "1": {
          "name": "variable.other.readwrite"
        },
        "2": {
          "name": "keyword.operator.assignment"
        }
      },
      "end": ";?",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#expression"
        }
      ]
    },
    "array_literal": {
      "begin": "\\[",
      "end": "\\]",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#constant_numeric"
        },
        {
          "include": "#string_literal"
        },
        {
          "include": "#expression"
        }
      ]
    },
    "binary_operators": {
      "match": "(<|>|<=|>=|==|!=|&&|\\|\\||[+\\-*/])",
      "name": "keyword.operator.binary"
    },
    "increment_operators": {
      "match": "(\\+\\+|--)",
      "name": "keyword.operator.increment"
    },
    "expression": {
      "patterns": [
        {
          "include": "#constant_numeric"
        },
        {
          "include": "#string_literal"
        },
        {
          "include": "#array_literal"
        },
        {
          "include": "#function_application"
        },
        {
          "include": "#object_construction"
        },
        {
          "include": "#method_call"
        },
        {
          "include": "#binary_operators"
        }
      ]
    },
    "expression_body": {
      "begin": "\\{",
      "end": "(?=\\})",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#markdown_header"
        },
        {
          "include": "#let_declaration"
        },
        {
          "include": "#assignment_statement"
        },
        {
          "include": "#for_in_loop"
        },
        {
          "include": "#for_c_loop"
        },
        {
          "include": "#if_statement"
        },
        {
          "include": "#else_clause"
        },
        {
          "include": "#while_statement"
        },
        {
          "include": "#object_construction"
        },
        {
          "include": "#expression"
        }
      ]
    },
    "object_construction": {
      "comment": "Object construction ClassName { ... }",
      "begin": "(\\w+)\\s*\\{",
      "beginCaptures": {
        "1": {
          "name": "entity.name.type"
        }
      },
      "end": "\\}",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#object_field"
        }
      ]
    },
    "object_field": {
      "comment": "field_name: value",
      "begin": "(\\w+)\\s*:",
      "beginCaptures": {
        "1": {
          "name": "variable.other.readwrite.interface"
        }
      },
      "end": "(?=,|\\})",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#expression"
        }
      ]
    },
    "method_call": {
      "comment": "obj.method()",
      "match": "(\\w+)\\.(\\w+)\\s*\\(",
      "captures": {
        "1": {
          "name": "variable.other.readwrite"
        },
        "2": {
          "name": "entity.name.function.method"
        }
      }
    },
    "markdown_header": {
      "comment": "Markdown headers # ## ###",
      "patterns": [
        {
          "match": "^\\s*(#{6})\\s+(.*)$",
          "captures": {
            "1": {
              "name": "punctuation.definition.heading.markdown"
            },
            "2": {
              "name": "entity.name.section.markdown.h6"
            }
          }
        },
        {
          "match": "^\\s*(#{5})\\s+(.*)$",
          "captures": {
            "1": {
              "name": "punctuation.definition.heading.markdown"
            },
            "2": {
              "name": "entity.name.section.markdown.h5"
            }
          }
        },
        {
          "match": "^\\s*(#{4})\\s+(.*)$",
          "captures": {
            "1": {
              "name": "punctuation.definition.heading.markdown"
            },
            "2": {
              "name": "entity.name.section.markdown.h4"
            }
          }
        },
        {
          "match": "^\\s*(#{3})\\s+(.*)$",
          "captures": {
            "1": {
              "name": "punctuation.definition.heading.markdown"
            },
            "2": {
              "name": "entity.name.section.markdown.h3"
            }
          }
        },
        {
          "match": "^\\s*(#{2})\\s+(.*)$",
          "captures": {
            "1": {
              "name": "punctuation.definition.heading.markdown"
            },
            "2": {
              "name": "entity.name.section.markdown.h2"
            }
          }
        },
        {
          "match": "^\\s*(#{1})\\s+(.*)$",
          "captures": {
            "1": {
              "name": "punctuation.definition.heading.markdown"
            },
            "2": {
              "name": "entity.name.section.markdown.h1"
            }
          }
        }
      ]
    },
    "for_c_init_statement": {
      "comment": "C-style for loop initialization statement",
      "patterns": [
        {
          "comment": "Let declaration in for loop (preferred)",
          "match": "(let)\\s+(\\w+)\\s*(=)",
          "captures": {
            "1": {
              "name": "storage.type.declaration.let"
            },
            "2": {
              "name": "variable.other.readwrite"
            },
            "3": {
              "name": "keyword.operator.assignment"
            }
          }
        },
        {
          "comment": "Variable assignment in for loop (requires existing variable)",
          "match": "(\\w+)\\s*(=|\\+=|-=|\\*=|/=|%=)",
          "captures": {
            "1": {
              "name": "variable.other.readwrite"
            },
            "2": {
              "name": "keyword.operator.assignment"
            }
          }
        }
      ]
    },
    "for_c_condition": {
      "comment": "C-style for loop condition",
      "patterns": [
        {
          "include": "#expression"
        },
        {
          "include": "#binary_operators"
        }
      ]
    },
    "for_c_update": {
      "comment": "C-style for loop update statement",
      "patterns": [
        {
          "comment": "Increment/decrement operators",
          "match": "(\\w+)(\\+\\+|--)",
          "captures": {
            "1": {
              "name": "variable.other.readwrite"
            },
            "2": {
              "name": "keyword.operator.increment"
            }
          }
        },
        {
          "comment": "Assignment operators in update",
          "match": "(\\w+)\\s*(\\+=|-=|\\*=|/=|%=)",
          "captures": {
            "1": {
              "name": "variable.other.readwrite"
            },
            "2": {
              "name": "keyword.operator.assignment"
            }
          }
        }
      ]
    }
  },
  "scopeName": "source.baml"
}
